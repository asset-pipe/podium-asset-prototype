import{removeNodes as e}from"./dom.js";import{marker as t,Template as n}from"./template.js";import{TemplateInstance as o}from"./template-instance.js";import{TemplateResult as r}from"./template-result.js";export{TemplateResult}from"./template-result.js";import{templateCaches as s}from"./template-factory.js";import{parts as a,render as l}from"./render.js";export{html}from"../lit-html.js";import{insertNodeIntoTemplate as i,removeNodesFromTemplate as m}from"./modify-template.js";const d=(e,t)=>`${e}--${t}`;let c=!0;void 0===window.ShadyCSS?c=!1:void 0===window.ShadyCSS.prepareTemplateDom&&(console.warn("Incompatible ShadyCSS version detected.Please update to at least @webcomponents/webcomponentsjs@2.0.2 and@webcomponents/shadycss@1.3.1."),c=!1);const p=e=>o=>{const r=d(o.type,e);let a=s.get(r);void 0===a&&(a={stringsArray:new WeakMap,keyString:new Map},s.set(r,a));let l=a.stringsArray.get(o.strings);if(void 0!==l)return l;const i=o.strings.join(t);if(void 0===(l=a.keyString.get(i))){const t=o.getTemplateElement();c&&window.ShadyCSS.prepareTemplateDom(t,e),l=new n(o,t),a.keyString.set(i,l)}return a.stringsArray.set(o.strings,l),l},S=["html","svg"],y=new Set,f=(e,t,n)=>{y.add(n);const o=e.querySelectorAll("style");if(0===o.length)return void window.ShadyCSS.prepareTemplateStyles(t.element,n);const r=document.createElement("style");for(let e=0;e<o.length;e++){const t=o[e];t.parentNode.removeChild(t),r.textContent+=t.textContent}if((e=>{S.forEach(t=>{const n=s.get(d(t,e));void 0!==n&&n.keyString.forEach(e=>{const{element:{content:t}}=e,n=new Set;Array.from(t.querySelectorAll("style")).forEach(e=>{n.add(e)}),m(e,n)})})})(n),i(t,r,t.element.content.firstChild),window.ShadyCSS.prepareTemplateStyles(t.element,n),window.ShadyCSS.nativeShadow){const n=t.element.content.querySelector("style");e.insertBefore(n.cloneNode(!0),e.firstChild)}else{t.element.content.insertBefore(r,t.element.content.firstChild);const e=new Set;e.add(r),m(t,e)}},h=(t,n,s)=>{const i=s.scopeName,m=a.has(n),d=n instanceof ShadowRoot&&c&&t instanceof r,S=d&&!y.has(i),h=S?document.createDocumentFragment():n;if(l(t,h,Object.assign({templateFactory:p(i)},s)),S){const t=a.get(h);a.delete(h),t.value instanceof o&&f(h,t.value.template,i),e(n,n.firstChild),n.appendChild(h),a.set(n,t)}!m&&d&&window.ShadyCSS.styleElement(n.host)};export{h as render};
